# 防抖和节流详解：性能优化的"刹车系统"

## 核心思想：性能优化

**_防抖和节流的核心目的都是为了限制函数的执行频率，避免在短时间内触发大量不必要的计算或请求，从而提升性能和使用体验。它们解决的都是“高频事件”带来的问题。_**

## 1. 防抖

### 通俗理解：“等你说完我再动”

- 想象一个场景：你在电梯门口，电梯门开始关闭。这时有人跑过来，电梯门检测到有人，就会重新打开。如果不断有人跑过来，电梯门就会**_一直处于“重新开门”的状态，直到没有人再来，它才会等待一段时间后真正关闭_**

- **_防抖的精髓就是_**： 在事件被触发后，等待一个设定的时间。如果在这个等待期内，事件又被触发，则重新开始计时。只有当等待期内事件不再被触发，函数才会执行。

- **_应用场景_**：
  - 搜索框输入联想（最经典的例子）
    - **_问题_**： 用户每输入一个字母就向服务器发送一次请求，会造成巨大的服务器压力，且可能返回顺序错乱的结果。
    - **_解决_**： 使用防抖，只有当用户停止输入（比如500毫秒内没再打字）后，才去发送请求。

  - 窗口大小调整
    - **_问题_**： 用户拖拽浏览器窗口时，会连续触发 `resize` 事件，如果这里面的计算逻辑很复杂，会导致页面卡顿。
    - **_解决_**： 使用防抖，直到用户**_调整完窗口大小_**后，再执行计算布局的函数。
  - **_表单验证_**：
    - **_问题_**： 用户输入过程中就实时验证格式（比如密码强度），可能会干扰用户。
    - **_解决_**： 使用防抖，在用户**_输入完毕_**后（比如停止输入1秒后）再进行验证
  - **_按钮提交（防止重复提交）_**：
    - **_问题_**： 用户疯狂点击提交按钮，可能会导致表单被重复提交多次。
    - **_解决_**： 使用防抖，在用户第一次点击后，在设定的时间内，后续的点击无效。

### 面试回答示例：

“防抖的核心是，在事件被频繁触发时，我只执行最后一次。比如搜索框的联想功能，我不会在用户每输入一个字符时就请求，而是会设置一个计时器，等他停止输入一段时间（比如300毫秒）后，才去发起请求，这样可以有效减少服务器压力。”

## 2. 节流

### 通俗理解：“按规定节奏来”

- 想象一个场景：地铁站的闸机，人流再大，也**_只能一个一个通过，并且通过的速度是固定的_**。你不可能因为10个人同时挤在闸机口，就让10个人瞬间通过。
- **_节流的精髓就是_**： 在一个单位时间内，无论事件被触发了多少次，函数都只会执行一次。
- **_技术上的应用场景_**：
  - **_滚动加载更多 / 无限滚动_**
    - **_问题_**： 监听页面滚动事件 `scroll`，用户一滚动就会触发非常多次。如果每次触发都去计算位置并判断是否要加载，性能会很差。
    - **_解决_**： 使用节流，比如每`500毫秒`才检查一次滚动位置，判断是否需要加载新内容。
  - **_鼠标移动 / 元素拖拽_**
    - **_问题_**： 监听 `mousemove` 事件，鼠标稍微移动一下就会触发几十次。
    - **_解决_**： 使用节流，保证跟随鼠标移动的元素（比如一个高亮框）的更新频率是固定的，比如每100毫秒更新一次位置，避免卡顿。
  - **_抢购按钮的点击_**
    - **_问题_**： 用户疯狂点击“立即抢购”按钮。
    - **_解决_**： 使用节流，比如设置每1秒内只能提交一次请求，即使用户点了10下，也只有第一下和1秒后的第一下是有效的。
  - **_播放器记录播放时间_**
    - **_问题_**： 视频 `timeupdate` 事件触发频率很高，如果每次都向服务器记录播放进度，请求会太多。
    - **_解决_**： 使用节流，每5秒才记录一次播放进度。

### 面试回答示例：

“节流的核心是，保证一个函数在固定的时间间隔内只执行一次。比如在实现滚动加载更多时，滚动事件会高频触发，但我可以用节流让它每300毫秒才去判断一次是否滚到了底部，而不是每次都去判断，这样就大大优化了性能。”

## 总结与对比（面试黄金法则）

|       特性       |           **_防抖 _**           |                 **_节流 _**                 |
| :--------------: | :-----------------------------: | :-----------------------------------------: |
| **_核心思想 _**  | 延迟执行，**_只执行最后一次 _** |       间隔执行，**_按固定频率执行 _**       |
| **_生活比喻 _**  | **_电梯门_**：等人走光了再关门  |      **_地铁闸机_**：每分钟只过10个人       |
|   **_关系图_**   | 事件触发 ...(等待)...> 执行函数 | 事件触发 -> 执行函数 ...(冷却)...> 执行函数 |
| **_应用关键词_** |     **_等一等，直到停下_**      |           **_有节奏，控制频率 _**           |
|  **_经典场景_**  |       搜索联想、窗口调整        |             滚动加载、鼠标移动              |

## 如何记忆？

- 手抖了，抖一抖就只认最后一次 -> **_防抖_**
- 节约流量，细水长流 -> **_节流_**
- 在面试中，清晰地表达出 **_“为什么用”_** 和 **_“它们之间的区别”_** ，并配上一两个生动的例子，就足以让面试官对你留下深刻印象了。
