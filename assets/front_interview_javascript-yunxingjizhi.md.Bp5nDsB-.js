import{_ as i,c as a,o as n,aQ as l}from"./chunks/framework.CtsLwA2Q.js";const c=JSON.parse('{"title":"Javascript的运行机制","description":"","frontmatter":{},"headers":[],"relativePath":"front/interview/javascript-yunxingjizhi.md","filePath":"front/interview/javascript-yunxingjizhi.md"}'),e={name:"front/interview/javascript-yunxingjizhi.md"};function t(p,s,h,r,k,d){return n(),a("div",null,s[0]||(s[0]=[l(`<h1 id="javascript的运行机制" tabindex="-1">Javascript的运行机制 <a class="header-anchor" href="#javascript的运行机制" aria-label="Permalink to &quot;Javascript的运行机制&quot;">​</a></h1><p>你可以把它想象成一个 “只有一个服务员的餐厅” 的故事 <em><strong>JavaScript 是一个“单线程”、“非阻塞”、“异步并发”的语言，它通过“事件循环(Event Loop)”来管理所有任务的执行顺序。</strong></em></p><h2 id="第一幕-基础设定-单线程的餐厅" tabindex="-1">第一幕：基础设定 - 单线程的餐厅 <a class="header-anchor" href="#第一幕-基础设定-单线程的餐厅" aria-label="Permalink to &quot;第一幕：基础设定 - 单线程的餐厅&quot;">​</a></h2><p>想象一个餐厅里：</p><ul><li><em><strong>只有一个服务员</strong></em>（这就是 <em><strong>JavaScript 主线程</strong></em>）</li><li>这个服务员一次只能做一件事（点菜、上菜、结账）</li><li>如果让服务员去等厨师做一道复杂的菜，整个餐厅就会停摆</li></ul><p><em><strong>问题</strong></em>： 如果有客人点了一道需要做1小时的菜，难道服务员就在厨房等1小时吗？其他客人怎么办？</p><h2 id="第二幕-解决方案-事件循环系统" tabindex="-1">第二幕：解决方案 - 事件循环系统 <a class="header-anchor" href="#第二幕-解决方案-事件循环系统" aria-label="Permalink to &quot;第二幕：解决方案 - 事件循环系统&quot;">​</a></h2><p>餐厅为了解决这个问题，建立了一套高效的体系：</p><h3 id="_1-前台区域-调用栈-call-stack" tabindex="-1">1. 前台区域（调用栈 Call Stack） <a class="header-anchor" href="#_1-前台区域-调用栈-call-stack" aria-label="Permalink to &quot;1. 前台区域（调用栈 Call Stack）&quot;">​</a></h3><ul><li>服务员当前正在处理的工作</li><li>遵循“后进先出”原则（比如收拾桌子时，最后放的碗最先拿走）</li><li>如果前台堆了太多工作，服务员就忙不过来了（页面卡顿）</li></ul><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">function</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> 点菜</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">()</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">  console</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">log</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">记录菜品</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">);</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> // 第一步</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  做菜</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">();</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> // 第二步</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">  console</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">log</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">服务下个客人</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">);</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> // 最后一步</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">function</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> 做菜</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">()</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">  console</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">log</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">开始做菜</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">);</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_2-后厨团队-web-apis" tabindex="-1">2. 后厨团队（Web APIs） <a class="header-anchor" href="#_2-后厨团队-web-apis" aria-label="Permalink to &quot;2. 后厨团队（Web APIs）&quot;">​</a></h3><ul><li>这不是服务员的能力，而是餐厅配备的专业团队： <ul><li><em><strong>定时器部门</strong></em>（setTimeout/setInterval）</li><li><em><strong>网络请求部门</strong></em>（AJAX/Fetch）</li><li><em><strong>事件监听部门</strong></em>（点击事件、键盘事件）</li><li><em><strong>文件处理部门</strong></em>（FileReader）</li></ul></li></ul><h3 id="_3-传菜窗口-任务队列-task-queue" tabindex="-1">3. 传菜窗口（任务队列 Task Queue） <a class="header-anchor" href="#_3-传菜窗口-任务队列-task-queue" aria-label="Permalink to &quot;3. 传菜窗口（任务队列 Task Queue）&quot;">​</a></h3><ul><li>后厨做完的菜都放在这里排队</li><li>服务员按顺序来取</li></ul><h3 id="_4-餐厅经理-事件循环-event-loop" tabindex="-1">4. 餐厅经理（事件循环 Event Loop） <a class="header-anchor" href="#_4-餐厅经理-事件循环-event-loop" aria-label="Permalink to &quot;4. 餐厅经理（事件循环 Event Loop）&quot;">​</a></h3><p>经理只有一个工作：</p><ul><li><em><strong>不断检查：前台是否空闲？如果空闲，就去传菜窗口把下一道菜拿到前台处理</strong></em></li></ul><h2 id="第三幕-完整工作流程" tabindex="-1">第三幕：完整工作流程 <a class="header-anchor" href="#第三幕-完整工作流程" aria-label="Permalink to &quot;第三幕：完整工作流程&quot;">​</a></h2><p>让我们看一个真实例子：</p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">console</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">log</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">客人进门</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">setTimeout</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">function</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> ()</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">  console</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">log</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">菜做好了，上菜</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">);</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">},</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 2000</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">console</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">log</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">继续接待下个客人</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><em><strong>执行过程：</strong></em></p><ul><li><ol><li><code>console.log(&#39;客人进门&#39;)</code> → 服务员立即完成 ✅</li></ol></li><li><ol start="2"><li>遇到 <code>setTimeout</code>：</li></ol><ul><li><ol><li>服务员对后厨说：&quot;2分钟后把这道菜做好&quot;</li></ol></li><li><ol start="2"><li><em><strong>然后服务员立即继续工作，不会等待</strong></em></li></ol></li></ul></li><li><ol start="3"><li><code>console.log(&#39;继续接待下个客人&#39;)</code> → 服务员立即完成 ✅</li></ol></li><li><ol start="4"><li>2分钟后）后厨把做好的菜放到<em><strong>传菜窗口</strong></em></li></ol></li><li><ol start="5"><li><em><strong>事件循环经理</strong></em>发现前台没人，就从传菜窗口取菜给服务员</li></ol></li><li><ol start="6"><li>服务员执行 <code>console.log(&#39;菜做好了，上菜&#39;)</code></li></ol></li></ul><p><em><strong>输出结果：</strong></em></p><div class="language-text vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code" tabindex="0"><code><span class="line"><span>客人进门</span></span>
<span class="line"><span>继续接待下个客人</span></span>
<span class="line"><span>（2秒后）</span></span>
<span class="line"><span>菜做好了，上菜</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="第四幕-vip服务-微任务机制" tabindex="-1">第四幕：VIP服务 - 微任务机制 <a class="header-anchor" href="#第四幕-vip服务-微任务机制" aria-label="Permalink to &quot;第四幕：VIP服务 - 微任务机制&quot;">​</a></h2><p>现实中餐厅还有 <em><strong>VIP快速通道</strong></em>：</p><ul><li><em><strong>普通传菜窗口</strong></em>（宏任务队列）：setTimeout、setInterval、UI渲染等</li><li><em><strong>VIP快速通道</strong></em>（微任务队列）：Promise、async/await</li></ul><p><em><strong>重要规则：VIP客户永远优先！</strong></em></p><p>当服务员完成当前工作后：</p><ul><li><ol><li><em><strong>先处理所有VIP客户</strong></em>（微任务队列）</li></ol></li><li><ol start="2"><li><em><strong>后才处理普通客户</strong></em>（宏任务队列）</li></ol></li></ul><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">console</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">log</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">普通客人</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">setTimeout</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">function</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> ()</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">  console</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">log</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">普通菜品</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">);</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">},</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 0</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">Promise</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">resolve</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">().</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">then</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">function</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> ()</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">  console</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">log</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">VIP菜品</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">);</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">console</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">log</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">继续服务</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><em><strong>执行顺序：</strong></em></p><ol><li><code>普通客人</code>（同步任务）</li><li><code>继续服务</code>（同步任务）</li><li><code>VIP菜品</code>（微任务优先）</li><li><code>普通菜品</code>（宏任务最后）</li></ol><div class="language-text vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code" tabindex="0"><code><span class="line"><span>普通客人</span></span>
<span class="line"><span>继续服务</span></span>
<span class="line"><span>VIP菜品</span></span>
<span class="line"><span>普通菜品</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="面试标准答案" tabindex="-1">面试标准答案 <a class="header-anchor" href="#面试标准答案" aria-label="Permalink to &quot;面试标准答案&quot;">​</a></h2><p><em><strong>JavaScript 的运行机制基于事件循环：</strong></em></p><ul><li><ol><li><em><strong>单线程</strong></em>：只有一个主线程执行代码</li></ol></li><li><ol start="2"><li><em><strong>任务分类</strong></em>：只有一个主线程执行代码</li></ol><ul><li>同步任务：立即执行</li><li>异步任务：交给 Web APIs 处理</li></ul></li><li><ol start="3"><li><em><strong>队列系统</strong></em>：</li></ol><ul><li>微任务队列：Promise、async/await（优先）</li><li>宏任务队列：setTimeout、事件回调等</li></ul></li><li><ol start="4"><li><em><strong>事件循环流程</strong></em>：</li></ol><ul><li>执行同步任务</li><li>清空所有微任务</li><li>取一个宏任务执行</li><li>重复循环</li></ul></li></ul><p>这种机制保证了 JavaScript 既能处理高并发请求，又不会阻塞主线程的执行。</p><h2 id="现实世界类比" tabindex="-1">现实世界类比 <a class="header-anchor" href="#现实世界类比" aria-label="Permalink to &quot;现实世界类比&quot;">​</a></h2><div class="markdown-table-wrapper"><table><thead><tr><th style="text-align:center;">JavaScript 概念</th><th style="text-align:center;">餐厅比喻</th></tr></thead><tbody><tr><td style="text-align:center;">主线程</td><td style="text-align:center;">唯一服务员</td></tr><tr><td style="text-align:center;">调用栈</td><td style="text-align:center;">服务员当前工作</td></tr><tr><td style="text-align:center;">Web APIs</td><td style="text-align:center;">后厨专业团队</td></tr><tr><td style="text-align:center;">任务队列</td><td style="text-align:center;">传菜窗口</td></tr><tr><td style="text-align:center;">事件循环</td><td style="text-align:center;">餐厅经理</td></tr><tr><td style="text-align:center;">微任务</td><td style="text-align:center;">VIP快速通道</td></tr></tbody></table></div>`,41)]))}const g=i(e,[["render",t]]);export{c as __pageData,g as default};
